function metaframe_embed_comments(){var a=["<h2>Viewer Comments</h2>",'<form method="post" class="mf-comment-form">','<input type="text" />',"<textarea></textarea>",'<input type="submit" value="Comment" />',"</form>",'<div class="mf-comments"></div>'];$(".notes").append(a.join("\n"));var b=metaframe_retrieve_comments();$(".mf-comment-form").on("submit",function(a){b(),a.preventDefault()}),b(),setInterval(b,6e5)}function metaframe_retrieve_comments(){function a(){var a=b();$(".mf-comments").html($(a).html())}function b(a){a=a||0;var d=document.createElement("div"),e=/^"|"?/g;if(void 0===c[a])return d;var f=c[a].split('","');if(f.length<=1)return d;for(var g=[],h=0;h<f.length;h++)g.push("<span>"),g.push(f[h].replace(e,"")),g.push("</span>");d.innerHTML=g.join("\n");var i=b(a+1);return i.appendChild(d),i}var c=[];return function(){console.log("(re)loading comments"),$.ajax({url:"/example.csv",contentType:"text/csv"}).done(function(b){var d=b.split("\n");d!==c&&(c=d,a())})}}$(document).ready(function(){function a(){$(".notes-anchor, .notes-tab").click(function(a){a.preventDefault(),$(".notes-tab").hasClass("open")?($(".notes").animate({right:"-330px"},300),$(".notes-tab").animate({right:"10px"},300),$(".notes-tab").removeClass("open")):($(".notes").animate({right:"0px"},300),$(".notes-tab").animate({right:"340px"},300),$(".notes-tab").addClass("open"))})}function b(){$(".notes-anchor, .notes-tab").click(function(a){a.preventDefault(),$(".notes-tab").hasClass("open")?($(".notes").animate({bottom:"-330px"},300),$(".notes-tab").animate({bottom:"10px"},300),$(".notes-tab").removeClass("open")):($(".notes").animate({bottom:"0px"},300),$(".notes-tab").animate({bottom:"340px"},300),$(".notes-tab").addClass("open"))})}$("<a/>",{"class":"notes-tab",href:"#"}).appendTo("body"),$("<div/>",{"class":"notes Scrollable"}).appendTo("body");var c=$(this).attr("title");$(".notes").html("<h1>"+c+"</h1>");var d=['<form><input type="checkbox" id="noteBox" checked="checked" >show note markers</form>',"<h2>Page Notes</h2>"];$(d.join("")).appendTo(".notes");for(var e=0,f=$(".notation").map(function(){return e++,$(this).attr("note")}),g=0;e-0>g;g++)$(".notes").append('<div class="note-holder"><span class="note-count">'+(g+1)+'</span><span class="note-body">'+f[g]+"</span></div");var h=0;$(".notation").each(function(){h++,$(this).prepend('<span class="notes-anchor"><figure>'+h+"</figure></span>")}),metaframe_embed_comments(),$(window).on("resize",function(){$(".notes-tab").removeClass("open"),$(".notes-anchor, .notes-tab").unbind("click"),$(window).width()>700?($(".notes").css({right:"-330px"}),$(".notes-tab").css({right:"10px"}),$(".notes").removeClass("bottom"),a()):($(".notes").css({bottom:"-330px"}),$(".notes-tab").css({bottom:"10px"}),$(".notes").addClass("bottom"),b())}),$(window).width()>700?a():($(".notes").addClass("bottom"),b()),$("#noteBox").click(function(){$(".notes-anchor").toggle()}),0===$(".note-body").size()&&$(".notes").append("<p>There are no notes yet. I guess you can go home early today!</p>"),$(".Scrollable").on("DOMMouseScroll mousewheel",function(a){var b=$(this),c=this.scrollTop,d=this.scrollHeight,e=b.height(),f=a.originalEvent.wheelDelta,g=f>0,h=function(){return a.stopPropagation(),a.preventDefault(),a.returnValue=!1,!1};return!g&&-f>d-e-c?(b.scrollTop(d),h()):g&&f>c?(b.scrollTop(0),h()):void 0})});